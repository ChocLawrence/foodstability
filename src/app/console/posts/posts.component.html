<div class="row p-3">
    <div class="col-12 mx-auto">
        <div class="bg-white shadow-sm rounded p-3 pt-sm-4 pb-sm-5 px-sm-4 mb-4">
            <h3 class="text-3 font-weight-400 mb-2 mb-sm-2">
                {{ "Posts" | translate }}
            </h3>
            <span><a class="btn btn-success btn-sm addButton" (click)="openPostModal('addPost', null)">
                    <i class="fa fa-plus"></i> </a></span>

            <br><br>
            <form [formGroup]="searchForm" (ngSubmit)="onSubmit()">
                <div class="row mb-3">
                    <div class="col-lg-3 col-md-6 mb-2">
                        <label class="small mb-1">{{ "Date Range" | translate }}</label>
                        <div class="input-group input-group-sm">
                            <div class="input-group-prepend">
                                <span class="input-group-text secondary">
                                    <i class="fa fa-calendar"></i>
                                </span>
                            </div>
                            <input style="pointer-events: none" (ngModelChange)="onSearch()" class="form-control"
                                [placeholder]="'From' | translate" name="dp" formControlName="startd"
                                [minDate]="minDate" [maxDate]="maxDate" ngbDatepicker #j="ngbDatepicker" />
                            <div class="input-group-append">
                                <button class="btn btn-primary btn-sm" id="startdd" (click)="j.toggle()" type="button">
                                    <i class="bi bi-calendar-check" aria-hidden="true"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 mb-2">
                        <label class="small mb-1">&nbsp;</label>
                        <div class="input-group input-group-sm">
                            <div class="input-group-prepend">
                                <span class="input-group-text secondary">
                                    <i class="fa fa-calendar"></i>
                                </span>
                            </div>
                            <input (ngModelChange)="onSearch()" style="pointer-events: none"
                                class="form-control input-sm inline-form-control" [placeholder]="'End Date' | translate"
                                name="dp" formControlName="enddate" [minDate]="minDate" [maxDate]="maxDate"
                                ngbDatepicker #k="ngbDatepicker" />
                            <div class="input-group-append">
                                <button class="btn btn-primary btn-sm" (click)="k.toggle()" type="button">
                                    <i class="bi bi-calendar-check" aria-hidden="true"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 mb-2">
                        <label class="small mb-1">{{ "Title" | translate }}</label>
                        <div class="input-group input-group-sm">
                            <div class="input-group-prepend">
                                <span class="input-group-text secondary">
                                    <i class="fa fa-book"></i>
                                </span>
                            </div>
                            <input type="text" class="form-control" [placeholder]="'Search by title...' | translate"
                                formControlName="title" (keyup.enter)="onSubmit()" />
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 mb-2">
                        <label class="small mb-1">{{ "DOI" | translate }}</label>
                        <div class="input-group input-group-sm">
                            <div class="input-group-prepend">
                                <span class="input-group-text secondary">
                                    <i class="fa fa-tag"></i>
                                </span>
                            </div>
                            <input type="text" class="form-control" [placeholder]="'Search by DOI...' | translate"
                                formControlName="doi" (keyup.enter)="onSubmit()" />
                        </div>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-lg-2 col-md-4 col-sm-6 mb-2">
                        <label class="small mb-1">{{ "Volume" | translate }}</label>
                        <div class="input-group input-group-sm">
                            <div class="input-group-prepend">
                                <span class="input-group-text secondary">
                                    <i class="fa fa-bookmark"></i>
                                </span>
                            </div>
                            <input type="number" class="form-control" [placeholder]="'Volume' | translate"
                                formControlName="volume" (keyup.enter)="onSubmit()" min="1" />
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-4 col-sm-6 mb-2">
                        <label class="small mb-1">{{ "Issue" | translate }}</label>
                        <div class="input-group input-group-sm">
                            <div class="input-group-prepend">
                                <span class="input-group-text secondary">
                                    <i class="fa fa-bookmark"></i>
                                </span>
                            </div>
                            <input type="number" class="form-control" [placeholder]="'Issue' | translate"
                                formControlName="issue" (keyup.enter)="onSubmit()" min="1" />
                        </div>
                    </div>
                    <div class="col-lg-8 col-md-4 col-sm-12 mb-2 d-flex align-items-end">
                        <button type="submit" class="btn btn-primary btn-sm mr-2">
                            <i class="fa fa-search"></i> {{ "Search" | translate }}
                        </button> &nbsp;
                        <button type="button" (click)="refreshDataSource()" class="btn btn-secondary btn-sm">
                            <i class="fa fa-undo"></i> {{ "Reset" | translate }}
                        </button>
                    </div>
                </div>
            </form>

            <dx-data-grid #postsContainer id="postsContainer" [dataSource]="posts" [columnAutoWidth]="true"
                [showBorders]="true" [showRowLines]="true" [showColumnLines]="false" [allowColumnReordering]="true"
                [allowCollapsing]="false" [wordWrapEnabled]="true" [hoverStateEnabled]="true"
                (onFileSaving)="_core.onFileSaving($event, 'Posts')">
                <dxo-column-chooser [enabled]="true"></dxo-column-chooser>
                <dxo-paging [enabled]="true" [pageSize]="10"></dxo-paging>
                <dxo-pager [showPageSizeSelector]="true" [allowedPageSizes]="[5, 10, 20, 30]" [showInfo]="true">
                </dxo-pager>
                <dxo-search-panel [visible]="true" [width]="240" [placeholder]="'Search...' | translate">
                </dxo-search-panel>

                <!-- Columns -->
                <dxi-column dataField="title" width="auto" [caption]="'Title' | translate">
                </dxi-column>
                <dxi-column dataField="slug" width="auto" [caption]="'Slug' | translate">
                </dxi-column>
                <dxi-column dataField="doi" width="auto" [caption]="'Doi' | translate">
                </dxi-column>
                <dxi-column dataField="volume" width="auto" [caption]="'Volume' | translate">
                </dxi-column>
                <dxi-column dataField="issue" width="auto" [caption]="'Issue' | translate">
                </dxi-column>
                <dxi-column dataField="image" width="auto" [caption]="'Image' | translate" cellTemplate="imageTemplate">
                </dxi-column>
                <dxi-column width="200" dataField="createdat" cellTemplate="createdAtTemplate"
                    [caption]="'Creation date' | translate">
                </dxi-column>
                <dxi-column cellTemplate="actionsTemplate" [caption]="" alignment="right">
                </dxi-column>

                <div *dxTemplate="let cell of 'imageTemplate'">
                    <img [src]="'data:image/png;base64,' +  cell.data.image" alt="" width="100" height="100">
                </div>

                <div *dxTemplate="let cell of 'createdAtTemplate'">
                    <span>
                        {{ cell.data.created_at ? getDate(cell.data.created_at) : "-" }}
                    </span>
                </div>

                <div *dxTemplate="let cell of 'actionsTemplate'">
                    <div class="mainActions" *ngIf="cell.data != null">
                        <ul>
                            <li>
                                <i class="fa fa-sm fa-eye theme" [title]="'View Post' | translate"
                                    (click)="openPostModal('view', cell.data)"></i>
                            </li>
                            <li>
                                <i class="fa fa-sm fa-edit theme" [title]="'Edit Post' | translate"
                                    (click)="openPostModal('updatePost', cell.data)"></i>
                            </li>
                            <li>
                                <i class="fa fa-sm fa-trash red" [title]="'Delete Post' | translate"
                                    (click)="openPostModal('deletePost', cell.data)"></i>
                            </li>
                        </ul>
                    </div>
                </div>

                <dxo-export [enabled]="true" fileName="Posts" [allowExportSelectedData]="false"
                    [customizeExcelCell]="customizeExcelCell"></dxo-export>
                <dxo-column-chooser [enabled]="true"></dxo-column-chooser>
            </dx-data-grid>
            <div class="row">
                <div class="col-12">
                    <app-pagination 
                        [paginationData]="genericPosts" 
                        (pageChange)="onPageChange($event)">
                    </app-pagination>
                </div>
            </div>
        </div>
    </div>
</div>

<app-modal-post #postModals [post]="thePost" [categories]="categories" [tags]="tags" [origin]="origin"
    [action]="postModalAction" (postModalClosed)="onPostModalClosed()">
</app-modal-post>

<ngx-loading [show]="loadingData" [config]="{
    backdropBorderRadius: '3px',
    fullScreenBackdrop: true,
    animationType: animationType
  }"></ngx-loading>